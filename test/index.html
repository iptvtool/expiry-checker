<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Expiry Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
--bg:#f7f7f7; --card:#ffffff; --text:#111111; --muted:#666666; --border:#cccccc;
--btn:#111111; --btnText:#ffffff; --resultBg:#f0f0f0; --shadow:0 4px 14px rgba(0,0,0,0.08);
--warnBg:#fff6e5; --warnBorder:#f1d18b;
}
body.dark{
--bg:#0f1115; --card:#171a21; --text:#f1f3f5; --muted:#a9b0bb; --border:#2b303a;
--btn:#f1f3f5; --btnText:#111111; --resultBg:#11141a; --shadow:0 8px 22px rgba(0,0,0,0.40);
--warnBg:#2a2517; --warnBorder:#6b5a2b;
}

body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:20px;display:flex;justify-content:center}
.card{background:var(--card);padding:22px;max-width:640px;width:100%;border-radius:12px;box-shadow:var(--shadow)}
.topbar{display:flex;align-items:flex-start;justify-content:space-between}
.toggle{border:1px solid var(--border);background:transparent;color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}

label{display:block;margin-top:14px;font-weight:600}
input,textarea{
width:100%;padding:10px;margin-top:6px;border-radius:10px;border:1px solid var(--border);
background:transparent;color:var(--text);box-sizing:border-box
}
textarea{min-height:120px;font-family:monospace}

.btnrow{display:flex;gap:10px;margin-top:16px}
button.primary{flex:1;padding:12px;background:var(--btn);color:var(--btnText);border:none;border-radius:10px;cursor:pointer}
button.secondary{flex:1;padding:12px;background:transparent;color:var(--text);border:1px solid var(--border);border-radius:10px;cursor:pointer}

.result{margin-top:16px;padding:12px;border-radius:10px;background:var(--resultBg);border:1px solid var(--border);white-space:pre-wrap}
.ok{color:#0aa07a;font-weight:800}
.bad{color:#d24545;font-weight:800}
.warn{color:#c78a00;font-weight:800}

.panel{margin-top:16px;padding:12px;border-radius:10px;background:var(--warnBg);border:1px solid var(--warnBorder);display:none}
.hint{font-size:12px;color:var(--muted);margin-top:10px}
</style>
</head>

<body>
<div class="card">

<div class="topbar">
<div>
<h1>Expiry Checker</h1>
<p class="hint">Runs in your browser only. Nothing is stored.</p>
</div>
<button id="themeBtn" class="toggle">Dark mode</button>
</div>

<label>Server URL</label>
<input id="server" placeholder="cf.example.com">

<label>Username</label>
<input id="username">

<label>Password</label>
<input id="password" type="password">

<div class="btnrow">
<button id="checkBtn" class="primary">Check expiry</button>
<button id="copyBtn" class="secondary">Copy result</button>
<button id="resetBtn" class="secondary">Reset</button>
</div>

<div id="output" class="result">Ready.</div>

<div id="fallback" class="panel">
<b>Direct check blocked</b>
<p id="fallbackMsg"></p>

<button id="openHttpsBtn" class="secondary">Open API (HTTPS)</button>
<button id="openHttpBtn" class="secondary">Open API (HTTP)</button>

<label>Paste JSON here</label>
<textarea id="jsonPaste"></textarea>
<button id="parseBtn" class="primary">Parse JSON</button>
</div>

<div class="hint">If check fails, open API and paste JSON.</div>
<div class="hint" style="text-align:center;margin-top:18px;">ver: 06-02-26</div>

</div>

<script>
(function(){

const out=document.getElementById("output");
const fallback=document.getElementById("fallback");
const fallbackMsg=document.getElementById("fallbackMsg");

let lastText="",lastHost="",lastUser="",lastPass="";

function trim(v){return(v||"").trim();}
function host(v){
v=trim(v).replace(/^https?:\/\//i,"");
return v.split("/")[0];
}
function api(s,h,u,p){
return s+"://"+h+"/player_api.php?username="+encodeURIComponent(u)+"&password="+encodeURIComponent(p);
}

function unix(sec){
const d=new Date(parseInt(sec,10)*1000);
return isNaN(d)?null:d;
}

function show(html,plain){lastText=plain;out.innerHTML=html;}
function text(t){lastText=t;out.textContent=t;}

document.getElementById("themeBtn").onclick=()=>{
document.body.classList.toggle("dark");
};

document.getElementById("copyBtn").onclick=()=>{
navigator.clipboard.writeText(lastText||out.textContent);
};

document.getElementById("resetBtn").onclick=()=>{
server.value="";username.value="";password.value="";
text("Ready.");fallback.style.display="none";
};

document.getElementById("openHttpsBtn").onclick=()=>{
window.open(api("https",lastHost,lastUser,lastPass));
};
document.getElementById("openHttpBtn").onclick=()=>{
window.open(api("http",lastHost,lastUser,lastPass));
};

function render(d){
const ui=d.user_info||{};
const ex=unix(ui.exp_date);
if(!ex){text("No expiry found");return;}
const days=Math.floor((ex-Date.now())/86400000);
const ok=days>=0;

show(
`<b>Status:</b> <span class="${ok?"ok":"bad"}">${ok?"ACTIVE":"EXPIRED"}</span><br>
<b>Expiry:</b> ${ex.toLocaleString()}<br>
<b>Days remaining:</b> ${days}`,
`Status: ${ok?"ACTIVE":"EXPIRED"}\nExpiry: ${ex}\nDays: ${days}`
);
}

document.getElementById("parseBtn").onclick=()=>{
try{render(JSON.parse(jsonPaste.value));}
catch{text("Invalid JSON");}
};

document.getElementById("checkBtn").onclick=async()=>{
fallback.style.display="none";

const raw=server.value.trim();
const u=trim(username.value);
const p=trim(password.value);

if(!raw||!u||!p){text("Fill all fields");return;}

let scheme=null;
let h=raw;

if(raw.startsWith("http://")){
scheme="http";
h=raw.replace(/^http:\/\//,"");
}
else if(raw.startsWith("https://")){
scheme="https";
h=raw.replace(/^https:\/\//,"");
}

h=h.split("/")[0];

lastHost=h; lastUser=u; lastPass=p;

async function tryFetch(s){
const r=await fetch(api(s,h,u,p));
const t=await r.text();
return JSON.parse(t);
}

try{
let data;

if(scheme){
data=await tryFetch(scheme);
render(data);
return;
}

try{
data=await tryFetch("https");
render(data);
return;
}catch{
data=await tryFetch("http");
render(data);
return;
}

}catch(e){
fallback.style.display="block";
fallbackMsg.textContent="Server blocked browser or returned invalid data.";
text("Direct check failed. Use fallback.");
}
};

})();
</script>

</body>
</html>
